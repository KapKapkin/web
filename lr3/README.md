# Лабораторная работа №3 - Flask аутентификация и сессии

Веб-приложение на Flask с демонстрацией работы сессий, аутентификации пользователей с использованием Flask-Login и управления доступом к страницам.

## Функциональность

### 1. Счетчик посещений
- **Главная страница** (`/`) - отображает количество посещений текущей сессии
- Каждая сессия имеет собственный счетчик
- Счетчик увеличивается при каждом обновлении страницы

### 2. Аутентификация пользователей
- **Страница входа** (`/login`) - форма для ввода логина и пароля
- Встроенный пользователь: `user` / `qwerty`
- Чекбокс "Запомнить меня" для сохранения сессии
- Автоматическое перенаправление после успешного входа
- Сообщения об ошибках при неверных данных

### 3. Секретная страница
- **Защищенная страница** (`/secret`) - доступ только для аутентифицированных пользователей
- Автоматическое перенаправление на страницу входа для неавторизованных
- После входа - возврат на изначально запрошенную страницу

### 4. Навигация
- Динамическое отображение ссылок в зависимости от статуса аутентификации
- Для авторизованных: ссылки на секретную страницу и выход
- Для неавторизованных: ссылка на вход

## Технические требования

### Аутентификация
- Использование `Flask-Login` для управления сессиями
- Хеширование паролей с помощью `Werkzeug`
- Поддержка функции "Запомнить меня"
- Защищенные роуты с декоратором `@login_required`

### Сессии
- Использование `Flask.session` для счетчика посещений
- Каждая сессия браузера имеет независимый счетчик
- Сессионные данные сохраняются между запросами

### Пользователи
- Класс `User` наследующий от `UserMixin`
- Встроенная база пользователей (в production использовать реальную БД)
- Функция загрузки пользователя для Flask-Login

## Запуск

```bash
# Установка зависимостей
pip install -r requirements.txt

# Запуск приложения
python app.py
```

Приложение будет доступно по адресу: http://127.0.0.1:5000

## Тестирование

```bash
# Запуск всех тестов
python -m pytest tests/test.py -v
```

Включает 14 тестов (превышает требуемые 10), покрывающих:

### Счетчик посещений
- ✅ Первое посещение показывает 1
- ✅ Множественные посещения увеличивают счетчик
- ✅ Разные сессии имеют независимые счетчики

### Аутентификация
- ✅ Успешный вход перенаправляет на главную с сообщением
- ✅ Неудачный вход показывает ошибку на той же странице
- ✅ Выход из системы очищает сессию

### Доступ к секретной странице
- ✅ Авторизованные пользователи имеют доступ
- ✅ Неавторизованные перенаправляются на вход
- ✅ После входа - возврат на изначально запрошенную страницу

### Функция "Запомнить меня"
- ✅ С галочкой устанавливается долгосрочная сессия
- ✅ Без галочки - обычная сессионная

### Навигация
- ✅ Правильные ссылки для авторизованных пользователей
- ✅ Правильные ссылки для неавторизованных пользователей
- ✅ Форма входа отображает все необходимые поля

## Структура проекта

```
lr3/
├── app.py                     # Основное приложение Flask
├── templates/                 # HTML шаблоны
│   ├── base.html             # Базовый шаблон с навигацией
│   ├── index.html            # Главная страница со счетчиком
│   ├── login.html            # Форма входа
│   └── secret.html           # Защищенная страница
├── tests/
│   └── test.py              # 14 тестов функциональности
├── requirements.txt          # Зависимости проекта
└── README.md                # Документация
```

## Безопасность

⚠️ **Важно для production:**
- Изменить `app.secret_key` на случайную строку
- Использовать реальную базу данных вместо словаря в памяти
- Добавить HTTPS для защиты передачи паролей
- Реализовать rate limiting для предотвращения брute force атак

## Демонстрируемые концепции

- **Flask-Login**: Управление пользовательскими сессиями
- **Session Management**: Работа с сессионными данными
- **Authentication Flow**: Полный цикл входа/выхода
- **Route Protection**: Защита маршрутов декораторами
- **Template Context**: Передача данных в шаблоны
- **Form Handling**: Обработка POST запросов
- **Flash Messages**: Система уведомлений пользователя
- **Redirects**: Управление навигацией после операций

## Автор

Гудяков Олег Артёмович, группа ИВТ-б-о-23