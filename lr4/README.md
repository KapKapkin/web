# Лабораторная работа №4 - Система управления пользователями

Веб-приложение для управления учётными записями пользователей, разработанное с использованием фреймворка Flask.

## Функциональность

### Аутентификация
- Регистрация новых пользователей
- Вход в систему с проверкой учетных данных
- Выход из системы
- Управление сессиями

### Управление пользователями (CRUD)
- **Создание**: Добавление новых пользователей с полной информацией
- **Чтение**: Просмотр списка пользователей и детальной информации
- **Обновление**: Редактирование данных пользователей
- **Удаление**: Удаление пользователей (с защитой от самоудаления)

### Управление паролями
- Безопасное хеширование паролей
- Смена пароля с проверкой текущего пароля
- Сложная валидация пароля (минимум 8 символов, различные типы символов)

### Система ролей
- Поддержка ролей пользователей (Администратор, Пользователь, Менеджер)
- Назначение ролей при создании и редактировании пользователей

## Технические особенности

### Архитектура
- **Фабрика приложений**: Использование паттерна Application Factory
- **Blueprints**: Разделение маршрутов на модули (auth, main)
- **SQLAlchemy ORM**: Работа с базой данных через ORM
- **Flask-Login**: Управление сессиями пользователей

### Валидация
- **WTForms**: Серверная валидация форм
- **Пользовательские валидаторы**: Сложная валидация паролей с regex
- **CSRF Protection**: Защита от CSRF-атак

### Безопасность
- Хеширование паролей с использованием Werkzeug
- Защищенные маршруты с декоратором `@login_required`
- Проверка прав доступа
- Защита от самоудаления пользователя

### UI/UX
- **Bootstrap 5**: Адаптивный дизайн
- **Flash-сообщения**: Информирование пользователя о результатах операций
- **Русскоязычный интерфейс**: Полная локализация
- **Удобная навигация**: Интуитивное меню и breadcrumbs

## Установка и запуск

### Требования
- Python 3.8+
- Flask и зависимости (см. requirements.txt)

### Установка зависимостей
```bash
pip install -r requirements.txt
```

### Запуск приложения
```bash
python app.py
```

Приложение будет доступно по адресу: http://localhost:5000

### Тестирование
```bash
pytest tests/ -v
```

## Структура проекта

```
lr4/
├── app/
│   ├── __init__.py          # Фабрика приложений
│   ├── models.py            # Модели данных (User, Role)
│   ├── forms.py             # Формы WTF с валидацией
│   ├── auth.py              # Маршруты аутентификации
│   └── routes.py            # Основные маршруты CRUD
├── templates/
│   ├── base.html            # Базовый шаблон
│   ├── auth/                # Шаблоны аутентификации
│   │   ├── login.html
│   │   └── register.html
│   └── user/                # Шаблоны управления пользователями
│       ├── index.html
│       ├── create.html
│       ├── view.html
│       ├── edit.html
│       ├── profile.html
│       └── change_password.html
├── tests/
│   ├── conftest.py          # Конфигурация тестов
│   └── test_app.py          # Основные тесты
├── config.py                # Конфигурация приложения
├── app.py                   # Точка входа
├── requirements.txt         # Зависимости
└── README.md               # Документация
```

## Тестирование

Проект включает комплексный набор тестов:

### Типы тестов
- **Аутентификация**: Тесты входа, выхода, регистрации
- **CRUD операции**: Тесты создания, чтения, обновления, удаления пользователей
- **Смена пароля**: Тесты функциональности смены пароля
- **Контроль доступа**: Тесты защищенных маршрутов
- **Валидация форм**: Тесты валидации входных данных

### Покрытие тестами
- ✅ Аутентификация (6 тестов)
- ✅ Управление пользователями (8 тестов)
- ✅ Смена пароля (4 теста)
- ✅ Контроль доступа (1 тест)
- ✅ Валидация форм (2 теста)

**Всего: 21 тест**

## Первоначальные данные

При первом запуске автоматически создаются:

### Роли
- **Администратор**: Полный доступ к системе
- **Пользователь**: Обычный пользователь
- **Менеджер**: Управление пользователями

### Тестовый пользователь
- **Логин**: admin
- **Пароль**: admin123
- **Роль**: Администратор

## Особенности реализации

### Валидация паролей
Пароли должны содержать:
- Минимум 8 символов
- Строчные буквы (a-z)
- Заглавные буквы (A-Z)
- Цифры (0-9)
- Специальные символы

### Безопасность
- Все пароли хешируются с использованием bcrypt
- CSRF-токены для всех форм
- Проверка авторизации для защищенных маршрутов
- Защита от SQL-инъекций через ORM

### Пользовательский опыт
- Информативные flash-сообщения
- Адаптивный дизайн для мобильных устройств
- Интуитивная навигация
- Подтверждение критических операций (удаление)

## Автор
Студент группы [номер группы]
Лабораторная работа по дисциплине "Веб-программирование"